<!doctype html><html lang=en><head><title>Monitoring the Fermentation of Sourdough Starter with Computer Vision</title>
<meta property="og:image" content="https://justinmklam.com//posts/2018/06/sourdough-starter-monitor/Crumb-comparison_hu_f97fc217c346e370.jpeg"><meta property="og:type" content="blog"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Bread is love, bread is life; would it be wrong to call it my wife?"><meta name=author content="Justin Lam"><link rel=stylesheet href=https://justinmklam.com/css/syntax.min.css media=screen><link rel=stylesheet href=https://justinmklam.com/css/syntax-dark.min.css media="screen and (prefers-color-scheme: dark)"><link rel=stylesheet href=https://justinmklam.com/css/styles.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-85178257-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-85178257-1")</script></head><body><div class="navbar row"><div><span class=navbar-brand>Justin Lam</span></div><div class=navbar-links><a href=/>Blog</a>
<a href=/projects/>Projects</a>
<a href=/about/>About</a>
<a href=/contact/>Contact</a></div></div><div><div class=single-content><h2 data-toc-skip class=blog-title>Monitoring the Fermentation of Sourdough Starter with Computer Vision</h2><p class=blog-title-metadata>Posted on June 24, 2018
&nbsp;&#183;&nbsp;15 min read
&nbsp;&#183;&nbsp;
<span class=disqus-comment-count data-disqus-url=https://justinmklam.com/posts/2018/06/sourdough-starter-monitor/#disqus_thread>0 comments</span>
&nbsp;&#183;&nbsp;
<a class=blog-tag href=/tags/programming>#programming&nbsp;</a></p><a href=/posts/2018/06/sourdough-starter-monitor/Crumb-comparison_hu_f97fc217c346e370.jpeg><img class="img-content img-content-header" src=/posts/2018/06/sourdough-starter-monitor/Crumb-comparison_hu_f97fc217c346e370.jpeg></a><details class=toc><summary>&nbsp;Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#the-backstory>The Backstory</a></li><li><a href=#the-development>The Development</a><ul><li><a href=#setting-up-the-timelapse>Setting Up the Timelapse</a><ul><li><a href=#loading-the-raspberry-pi-zero-headless>Loading the Raspberry Pi Zero (Headless)</a></li><li><a href=#creating-the-scripts>Creating the Scripts</a></li></ul></li><li><a href=#taking-the-timelapses>Taking the Timelapses</a></li><li><a href=#the-analysis>The Analysis</a><ul><li><a href=#thresholding-the-image>Thresholding the Image</a></li><li><a href=#quantifying-the-image>Quantifying the Image</a></li></ul></li><li><a href=#the-results>The Results</a><ul><li><a href=#may-29-left-jar>May 29, Left Jar</a></li><li><a href=#may-29-right-jar>May 29, Right Jar</a></li><li><a href=#may-31-first-feeding>May 31, First Feeding</a></li><li><a href=#may-31-second-feeding>May 31, Second Feeding</a></li><li><a href=#june-10-out-of-fridge>June 10, Out of Fridge</a></li><li><a href=#june-23-first-feeding>June 23, First Feeding</a></li><li><a href=#june-23-refeeding>June 23, Refeeding</a></li></ul></li><li><a href=#the-discussion>The Discussion</a><ul><li><a href=#effect-of-regular-feeding>Effect of Regular Feeding</a></li><li><a href=#bringing-the-starter-back-to-life>Bringing the Starter Back to Life</a></li></ul></li><li><a href=#the-conclusion>The Conclusion</a></li></ul></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></summary></details><div class="blog-content page-content"><p>Bread, the quintessence of life. People have survived for centuries off this staple consisting only of flour, water, salt, and yeast. Try consuming all these ingredients separately, and you&rsquo;ll be in for a digestive surprise. However, mix them together and let time do its thing, and the result is the release of profound flavour, texture, and nutrients that were previously locked away.</p><p>Despite it being relatively easy to turn dough into something that looks and feels like bread, the challenge is in squeezing every possible ounce of flavour and texture (using only those four ingredients) to achieve the embodiment of a true loaf of bread. The secret to artisinal bread is <strong>all in the fermentation.</strong> A baker&rsquo;s skill is in their ability to manage and control the fermentation process, which is usually achieved through countless months and/or years of trial and error.</p><p><strong>But what if there was a better way to understand what happens during the fermentation process?</strong></p><p>In this blog post, we dive into the world of wild yeast (commonly known as sourdough starter) by tracking its growth through timelapses, automated image analysis, and cool graph animations. Read on to find out more!</p><div class="row img-captioned"><video class="img-responsive img-content" autoplay loop controls>
<source src=timelapse.mp4 type=video/mp4></video><p class=caption>Timelapse taken over ~10 hours at 5 minute intervals. Shown: Two sourdough starters with different feeding ratios.</p></div><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-05-29%20Levain%20Timelapse.mp4 type=video/mp4></video><p class=caption>Image analysis for tracking growth of the above timelapse.</p></div><h1 id=the-backstory class=anchor><a href=#the-backstory>The Backstory</a></h1><p>Two key components in making artisinal bread are <strong>time</strong> and <strong>fermentation</strong>. If you can afford a long, slow rise, you will be rewarded with a texture like no other, and flavours that are both complex and subtle. Most bakeries unfortunately do not have this luxury (since it&rsquo;s a business after all), so commercial instant dry yeast is used to expedite the fermentation such that it reaches the desired loaf volume at a reasonable schedule. With bread risen with instant dry yeast, it will definitely resemble visual qualities of bread, but the texture and taste will not be comparable to bread that uses wild yeast.</p><p>The quest for achieving the perfect loaf is an arduous one. It can take upwards of 12 hours from the first mix to actually being able to bake the loaf, and environmental factors (ie. temperature and humidity) can alter the dough&rsquo;s behaviour (ie. in how it absorbs water, or how fast/slow the fermentation occurs). With every loaf being slightly different, it can be challenging to identify what processes need adjusting to get one step closer to that perfect loaf.</p><p>For context, a typical process for making an artisinal loaf is roughly described below:</p><ol><li>Discard 80-90% of the sourdough starter and feed it with flour and water.</li><li>Wait a few hours for the starter to ferment and double or triple in size.</li><li>At its peak, take the starter and mix it in with the rest of the bread ingredients.</li><li>Gently fold the dough to tighten it up (which creates the gluten) a few times for the first 1-2 hours.</li><li>Let rest. Flavours are developed during this bulk fermentation period.</li><li>Shape the loaf and place it in a proofing basket.</li><li>Let rest. The final volume is achieved during this second fermentation.</li><li>Bake.</li><li>Place on cooling rack when done, and listen to the song of the crackling crust while you wait to cut it open.</li></ol><p>Sourdough starter is a living organism, and as such should be treated with kindness, respect, and most importantly, food. A well-fed starter is an active and happy one; if we can get a feel for how the starter behaves on a day-to-day basis during its feeding (ie. when the fermentation occurs), it may help clear up at least one of the variables in bread baking.</p><p>One way to achieve this understanding is simply through trial and error. But we can do better. We can use (rather simple) <strong>computer vision</strong>!</p><p>The loaf&rsquo;s holey texture (ie. the elusive open crumb) is largely determined by activeness of the starter, so this is where we shall put our initial efforts. <strong>Specifically, we want to understand</strong>:</p><ul><li>When the starter reaches its maximum fermentation,</li><li>How consistent the starter&rsquo;s fermentation is, and</li><li>What happens when the starter is neglected and how quickly it can come back to life.</li></ul><p>To answer these questions, our plan of action is to:</p><ol><li>Take a timelapse of starter</li><li>Write an image analysis script to locate the current height of the starter in each image</li><li>Plot the height over time to get its growth characteristics</li></ol><p>Enough with the walls of text. Let&rsquo;s get on to the fun stuff!</p><h1 id=the-development class=anchor><a href=#the-development>The Development</a></h1><h2 id=setting-up-the-timelapse class=anchor><a href=#setting-up-the-timelapse>Setting Up the Timelapse</a></h2><p>For ease and convenience, the timelapse was set up on a Raspberry Pi. I initially had the idea to eventually create a real-time analysis of the starter (ie. a Python script updating a locally hosted dashboard), but I figured post processing a timelapse was good enough for now to answer those questions. You can pretty much use any camera to take a timelapse.</p><h3 id=loading-the-raspberry-pi-zero-headless class=anchor><a href=#loading-the-raspberry-pi-zero-headless>Loading the Raspberry Pi Zero (Headless)</a></h3><p>Setting up a Raspberry Pi is very easy these days:</p><ol><li>Download <a href=https://www.raspberrypi.org/downloads/raspbian/>Raspbian</a></li><li>Flash it to an SD card with something like <a href=https://etcher.io/>Etcher</a></li></ol><p>The only hiccup I ran into was setting up without any monitor or ethernet attached, so getting it connected to WiFi and retrieving its IP address was non-trivial. Luckily, other people had run into the same problem over at the <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=191252">Raspberry Pi forums</a>.
The solution:</p><ol><li>Create an empty file on the SD&rsquo;s boot partition called <code>ssh</code> to enable it.</li><li>Create another file named <code>wpa_supplicant.conf</code> with the following content:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>country</span><span class=o>=</span><span class=n>US</span>
</span></span><span class=line><span class=cl><span class=n>ctrl_interface</span><span class=o>=</span><span class=n>DIR</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>wpa_supplicant</span> <span class=n>GROUP</span><span class=o>=</span><span class=n>netdev</span>
</span></span><span class=line><span class=cl><span class=n>update_config</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>network</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ssid</span><span class=o>=</span><span class=s2>&#34;your_real_wifi_ssid&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>scan_ssid</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>psk</span><span class=o>=</span><span class=s2>&#34;your_real_password&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>key_mgmt</span><span class=o>=</span><span class=n>WPA</span><span class=o>-</span><span class=n>PSK</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Connect the camera module and boot it up. You can use something like <a href=https://angryip.org/download/#linux>Angry IP Scanner</a> to find its IP address, and with any luck you should be able to SSH into it from your own computer!</p><h3 id=creating-the-scripts class=anchor><a href=#creating-the-scripts>Creating the Scripts</a></h3><p>Fortunately, the Pi comes loaded with <code>raspistill</code>, a command line tool to capture images (see <a href=https://www.raspberrypi.org/documentation/usage/camera/raspicam/raspistill.md>here</a> for documentation). All we need to do is to write a simple shell script to execute this command every N seconds to create a timelapse.</p><p><strong>Note</strong>: The easiest option is to use the built in <a href=https://www.raspberrypi.org/documentation/usage/camera/raspicam/timelapse.md>timelapse mode</a>. However, I decided to make my own script to have more control over the filenames and where the images get saved.</p><h4 id=folder-structure class=anchor><a href=#folder-structure>Folder Structure</a></h4><p>I set up two scripts, one to take the timelapses, and another to start the timelapse as a background process. The <code>run</code> script is in the home directory so I can execute the command right when I login through the command line.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    home/pi/
</span></span><span class=line><span class=cl>    ├── sourdough-monitor/
</span></span><span class=line><span class=cl>    │   ├── imgs/
</span></span><span class=line><span class=cl>    │   └── timelapse.sh
</span></span><span class=line><span class=cl>    └── run_sourdough_monitor.sh
</span></span></code></pre></div><h4 id=scripts class=anchor><a href=#scripts>Scripts</a></h4><p>In <code>timelapse.sh</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Calls &#39;raspistill&#39; every 300s (ie. 5 mins) and writes the images</span>
</span></span><span class=line><span class=cl><span class=c1># to a new date/timestamped folder.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TOTAL_DELAY</span><span class=o>=</span><span class=m>300</span> <span class=c1># in seconds</span>
</span></span><span class=line><span class=cl><span class=nv>CAM_DELAY</span><span class=o>=</span><span class=m>1</span> <span class=c1># need to have a nonzero delay for raspistill</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Must be 1.33 ratio</span>
</span></span><span class=line><span class=cl><span class=nv>RES_W</span><span class=o>=</span><span class=m>1440</span>
</span></span><span class=line><span class=cl><span class=nv>RES_H</span><span class=o>=</span><span class=m>1080</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Calculate the total delay time per cycle</span>
</span></span><span class=line><span class=cl><span class=nv>SLEEP_DELAY</span><span class=o>=</span><span class=k>$((</span><span class=nv>$TOTAL_DELAY</span><span class=o>-</span><span class=nv>$CAM_DELAY</span><span class=k>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>FOLDER_NAME</span><span class=o>=</span>imgs
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$FOLDER_NAME</span> <span class=c1># create image root folder if not exist</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>IDX</span><span class=o>=</span><span class=m>0</span> <span class=c1># image index</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> cleanup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Exiting.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>trap</span> cleanup INT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=nv>DATE</span><span class=o>=</span><span class=k>$(</span>date +%Y-%m-%d_%H-%M-%S<span class=k>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>FNAME</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>DATE</span><span class=si>}</span><span class=s2>_(</span><span class=si>${</span><span class=nv>IDX</span><span class=si>}</span><span class=s2>)&#34;</span> <span class=c1># image filename</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Create folder for current timelapse set</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> <span class=nv>$IDX</span> -eq <span class=m>0</span> <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=k>then</span>
</span></span><span class=line><span class=cl>                <span class=nv>FOLDER_NAME</span><span class=o>=</span><span class=nv>$FOLDER_NAME</span>/<span class=nv>$DATE</span>
</span></span><span class=line><span class=cl>                mkdir -p <span class=nv>$FOLDER_NAME</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;Created folder: </span><span class=si>${</span><span class=nv>FOLDER_NAME</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        <span class=c1># Take image</span>
</span></span><span class=line><span class=cl>        raspistill --nopreview -t <span class=nv>$CAM_DELAY</span> -o ./<span class=nv>$FOLDER_NAME</span>/<span class=nv>$FNAME</span>.jpg -w <span class=nv>$RES_W</span> -h <span class=nv>$RES_H</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Captured: </span><span class=si>${</span><span class=nv>FNAME</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nv>IDX</span><span class=o>=</span><span class=k>$((</span>IDX+1<span class=k>))</span>
</span></span><span class=line><span class=cl>        sleep <span class=nv>$SLEEP_DELAY</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>And in <code>run_sourdough_monitor.sh</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Convenience script to run the monitor from home directory and launch</span>
</span></span><span class=line><span class=cl><span class=c1># in background</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> sourdough-monitor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Start in background so ssh session can be closed</span>
</span></span><span class=line><span class=cl>nohup ./timelapse.sh <span class=p>&amp;</span>&gt; /dev/null <span class=p>&amp;</span>
</span></span></code></pre></div><p>Nothing fancy here, so let&rsquo;s move along.</p><h2 id=taking-the-timelapses class=anchor><a href=#taking-the-timelapses>Taking the Timelapses</a></h2><p>Sometimes having kludgy setups is the best way forward. Might not be as pretty, but when bread is on the menu then nothing else matters. All we&rsquo;re here for is the data!</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/IMG_20180527_173837_hu_d4d5bb55c26db8d6.jpg><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/IMG_20180527_173837_hu_d4d5bb55c26db8d6.jpg></a><p class=caption>Sometimes random parts and a bit of tape are the best way forward.</p></div></p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/IMG_20180527_225557_hu_4855cb7fd7379e04.jpg><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/IMG_20180527_225557_hu_4855cb7fd7379e04.jpg></a><p class=caption>The light was originally placed in front (as shown above), but a better method was to put the light behind the jars to maximize contrast and minimize glare.</p></div></p><p>To start the timelapse, ssh into the Pi and execute the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./run_sourdough_monitor.sh
</span></span></code></pre></div><p>The next morning, you can ssh back in and kill the process with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pkill timelapse
</span></span></code></pre></div><p>Once you have it set up on the Pi, you can also control it with your phone and something like <a href="https://play.google.com/store/apps/details?id=com.sonelli.juicessh&amp;hl=en_CA">JuiceSSH</a> to feel super techy.</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/Screenshot_JuiceSSH_20180623-124103.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/Screenshot_JuiceSSH_20180623-124103.png></a><p class=caption>Starting the timelapse on Android, because why not?</p></div></p><p>Now we have some data to analyze!</p><h2 id=the-analysis class=anchor><a href=#the-analysis>The Analysis</a></h2><p>The computer vision part of this project was quite straightforward, thanks to scikit-learn. All we have to do is to:</p><ol><li>Apply a binary threshold to the image to get two distinct regions</li><li>Find the location of the boundary line</li></ol><p>Fortunately, these are very easy to do with this library! The two main required components:</p><ul><li><a href=http://scikit-image.org/docs/dev/auto_examples/segmentation/plot_thresholding.html>skimage.filters</a> - For applying thresholds</li><li><a href=http://scikit-image.org/docs/dev/auto_examples/segmentation/plot_regionprops.html>skimage.measure</a> - For measuring region properties</li></ul><p>Everything discussed in this blog post is also available on my <a href=https://github.com/justinmklam/sourdough-starter-monitor>Github</a>.</p><h3 id=thresholding-the-image class=anchor><a href=#thresholding-the-image>Thresholding the Image</a></h3><p>There are many threshold algorithms to choose from, and fortunately scikit-learn comes with a handy function to try them all at once.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>skimage.filters</span> <span class=kn>import</span> <span class=n>try_all_threshold</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=s1>&#39;2018-05-31 Levain Timelapse/test.jpg&#39;</span><span class=p>,</span> <span class=n>as_grey</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>650</span><span class=p>:</span><span class=mi>1100</span><span class=p>]</span>   <span class=c1># crop image to zoom in to jar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>try_all_threshold</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>),</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p>Running the above code yields the following image:</p><p>![The try_all_threshold() function is fast and convenient to see which will likely be the best for an image.](Threshold Comparison_1.png)</p><p>Discussing the different thresholding algorithms is beyond the scope of this post, but what we&rsquo;re looking for is one that is able to separate the boundary between the clear glass jar and the opaque sourdough starter. From the image above, it looks like isodata, otsu, and yen provide the sharpest thresholded boundary.</p><p>Given a hot tip from my coworker (thanks Andreas) that Otsu&rsquo;s method is a good one to pick, we can dig deeper into it. From the docs:</p><blockquote><p>Otsu’s method calculates an “optimal” threshold (marked by a red line in the histogram below) by maximizing the variance between two classes of pixels, which are separated by the threshold. Equivalently, this threshold minimizes the intra-class variance. - <a href=http://scikit-image.org/docs/dev/auto_examples/segmentation/plot_thresholding.html>SciKit Image Docs</a></p></blockquote><p>The main takeaway with Otsu&rsquo;s method is that it works best with a bimodal distribution. For our image, this means the histogram should be represented by two distinct peaks. Since our cropped image looks to have two visually different areas (ie. transparent glass at the top, flour/water mixture at the bottom), let&rsquo;s confirm that this method will work.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>ravel</span><span class=p>(),</span> <span class=n>bins</span><span class=o>=</span><span class=mi>256</span><span class=p>,</span> <span class=nb>range</span><span class=o>=</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>),</span> <span class=n>fc</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>ec</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Histogram of Original Image&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p>Plotting the histogram yields the following result:</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/histogram.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/histogram.png></a><p class=caption>The image is a bimodal histogram, so Otsu&rsquo;s method should work well. (Please forgive my unlabelled axes.)</p></div></p><p>Great, the histogram shows just what we need! (Except for the high concentration of saturated pixels, but let&rsquo;s just ignore that for now&mldr;)</p><p>Taking a closer look at the thresholded image:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>skimage.filters</span> <span class=kn>import</span> <span class=n>threshold_otsu</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>thresh</span> <span class=o>=</span> <span class=n>threshold_otsu</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>nbins</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>binary_img</span> <span class=o>=</span> <span class=n>img</span> <span class=o>&lt;</span> <span class=n>thresh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>ncols</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>cmap</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>cm</span><span class=o>.</span><span class=n>gray</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Original image&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>binary_img</span><span class=p>,</span> <span class=n>cmap</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>cm</span><span class=o>.</span><span class=n>gray</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Result&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/Threshold%20Comparison.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/Threshold%20Comparison.png></a><p class=caption>The result of Otsu&rsquo;s thresholding method.</p></div></p><p>Those white blobs on the walls of the jar may still be detected as regions of interest, but applying a minimum thresholded area will help with false positives. Luckily, we have moderate control of the lighting and contrast of the object in question. If we&rsquo;re lucky we won&rsquo;t have to change much for the timelapses taken at different times of the day!</p><h3 id=quantifying-the-image class=anchor><a href=#quantifying-the-image>Quantifying the Image</a></h3><p>With our binary image, we can now use skimage.measure to easily get quantified properties of the regions. Full list of properties can be found <a href=http://scikit-image.org/docs/dev/api/skimage.measure.html#skimage.measure.regionprops>in the docs</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>height</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>binary_img</span><span class=p>,</span> <span class=n>cmap</span><span class=o>=</span><span class=n>plt</span><span class=o>.</span><span class=n>cm</span><span class=o>.</span><span class=n>gray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>label_img</span> <span class=o>=</span> <span class=n>label</span><span class=p>(</span><span class=n>binary_img</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>regions</span> <span class=o>=</span> <span class=n>regionprops</span><span class=p>(</span><span class=n>label_img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>props</span> <span class=ow>in</span> <span class=n>regions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>y0</span><span class=p>,</span> <span class=n>x0</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=n>centroid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>minr</span><span class=p>,</span> <span class=n>minc</span><span class=p>,</span> <span class=n>maxr</span><span class=p>,</span> <span class=n>maxc</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=n>bbox</span>
</span></span><span class=line><span class=cl>    <span class=n>bx</span> <span class=o>=</span> <span class=p>(</span><span class=n>minc</span><span class=p>,</span> <span class=n>maxc</span><span class=p>,</span> <span class=n>maxc</span><span class=p>,</span> <span class=n>minc</span><span class=p>,</span> <span class=n>minc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>by</span> <span class=o>=</span> <span class=p>(</span><span class=n>minr</span><span class=p>,</span> <span class=n>minr</span><span class=p>,</span> <span class=n>maxr</span><span class=p>,</span> <span class=n>maxr</span><span class=p>,</span> <span class=n>minr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>area</span> <span class=o>=</span> <span class=p>(</span><span class=n>maxc</span><span class=o>-</span><span class=n>minc</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>maxr</span><span class=o>-</span><span class=n>minr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>area</span> <span class=o>&gt;=</span> <span class=n>min_area</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Plot the bounding box</span>
</span></span><span class=line><span class=cl>        <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>bx</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=s1>&#39;-b&#39;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>2.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Plot the centroid</span>
</span></span><span class=line><span class=cl>        <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x0</span><span class=p>,</span> <span class=n>y0</span><span class=p>,</span> <span class=s1>&#39;ro&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>height</span> <span class=o>=</span> <span class=n>minr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p>The resultant image below shows how multiple areas are detected and classified. However, we can apply some RI(TM) (aka. <em>real</em> intelligence) to only pick the region of the sourdough starter. There are many ways to do this, but the simplest was to simply set a minimum area requirement. As long as it&rsquo;s high enough, it should ignore all the other regions.</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/min-area.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/min-area.png></a><p class=caption>Minimum area is required since other areas will register as a detected region.</p></div></p><p>Due to the camera perspective and curvature of the jar, the boundary between the two regions is not actually straight. This was solved by taking a much narrower cropped region, which you will see below in the animated timelapses.</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/first-thresh.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/first-thresh.png></a><p class=caption>This may have been a bit easier with a square container&mldr;</p></div></p><p>Now that we have a working understanding of the components we need, let&rsquo;s get scripting and collect a bunch of data! You can check out the full analysis on <a href=https://github.com/justinmklam/sourdough-starter-monitor>Github</a>.</p><h2 id=the-results class=anchor><a href=#the-results>The Results</a></h2><p>The timelapses below show the sourdough starter from different dates. The boundary tracking algorithm is reasonably well at detecting the correct height, but there are occasional outliers that cause the errors. However, the overall trend of the growth is still captured.</p><h3 id=may-29-left-jar class=anchor><a href=#may-29-left-jar>May 29, Left Jar</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-05-29%20Levain%20Timelapse.mp4 type=video/mp4></video><p class=caption>The rise on the left jar had the cleanest growth trace.</p></div><h3 id=may-29-right-jar class=anchor><a href=#may-29-right-jar>May 29, Right Jar</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-05-29%20Levain%20Timelapse,%20Right.mp4 type=video/mp4></video><p class=caption>A narrow crop area had to be used to prevent detection of uneven rise levels.</p></div><h3 id=may-31-first-feeding class=anchor><a href=#may-31-first-feeding>May 31, First Feeding</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-05-31%20Levain%20Timelapse.mp4 type=video/mp4></video><p class=caption>Sunlight through the kitchen window created glare on the bottom left area on the jar, which affected the binary thresholding.</p></div><h3 id=may-31-second-feeding class=anchor><a href=#may-31-second-feeding>May 31, Second Feeding</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-05-31%20Levain%20Timelapse%202.mp4 type=video/mp4></video><p class=caption>Having the jar farther away reduced the thresholding accuracy, but the overall trace was still acceptable.</p></div><h3 id=june-10-out-of-fridge class=anchor><a href=#june-10-out-of-fridge>June 10, Out of Fridge</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-06-10%20Out%20of%20Fridge.mp4 type=video/mp4></video><p class=caption>A larger jar was needed for this one! The thresholding algorithm was surprisingly still able ot catch the peak to some extent, despite minimal contrast.</p></div><h3 id=june-23-first-feeding class=anchor><a href=#june-23-first-feeding>June 23, First Feeding</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-06-23%20First%20Feeding.mp4 type=video/mp4></video><p class=caption>After some neglect, the starter only rose to ~50%...</p></div><h3 id=june-23-refeeding class=anchor><a href=#june-23-refeeding>June 23, Refeeding</a></h3><div class="row img-captioned"><video class="img-responsive img-span-row img-content" autoplay loop muted controls>
<source src=2018-06-23%20Refeeding.mp4 type=video/mp4></video><p class=caption>But after another feeding the next morning, it had enough activity to spring back ~80% growth!</p></div><h2 id=the-discussion class=anchor><a href=#the-discussion>The Discussion</a></h2><p>The animations are cool to watch, but what can we interpret from it? Plotting all the growths (as shown below), we see that they seem more similar than different. The peaks hover around 60-80%, and the rate of growth coming up to the peak are similar.</p><p><div class="row img-captioned"><a href=/posts/2018/06/sourdough-starter-monitor/all-growths_1.png><img loading=lazy class="img-responsive img-content" src=/posts/2018/06/sourdough-starter-monitor/all-growths_1.png></a><p class=caption>All the timelapses plotted to compare normalized growth. Horizontal dotted line indicates 50% mark.</p></div></p><h3 id=effect-of-regular-feeding class=anchor><a href=#effect-of-regular-feeding>Effect of Regular Feeding</a></h3><p>Taking only a select number of days, there is a clearer trend to be seen. The graph below shows how the growth magnitude and rate increases over frequent and regularly scheduled feedings.</p><p>On May 29th, we began to feed our sourdough starter after many months of sporadic feeding. With the June 10th growth, the ramp up occured later but eventually rises to ~80%. The ideal growth target is to double or triple in size, but hopefully that time will come with even more regular feeding.</p><div class="row img-captioned"><a href=Levain%20Growth%20Over%20Time%20%28Regular%20Feeding%29.png><img class="img-responsive img-content" src=Levain%20Growth%20Over%20Time%20%28Regular%20Feeding%29.png></a><p class=caption>We can see that regularly feeding the sourdough starter greatly increases its rate and growth.</p></div><p><strong>Note</strong>: The time delay of each subsequent feeding is not a result of regularity, but rather because the starter to food ratio was reduced over time to promote a more active fermentation. We eventually migrated to a 50g starter + 100g water + 100g flour (50 / 50 white and whole wheat). The starter has more potential for growth by beginning with less starter and more food, but as a result it may take a bit longer for the bacteria to vigorously start multiplying.</p><h3 id=bringing-the-starter-back-to-life class=anchor><a href=#bringing-the-starter-back-to-life>Bringing the Starter Back to Life</a></h3><p>Previous to June 23, the starter was neglected for a week. After the first (overnight) feeding, it showed little signs of growth. However, feeding it again around noon and tracking its progress shows that the growth springs back up to ~80%, which was around the previous maximum from before.</p><div class="row img-captioned"><a href=refeeding_1.png><img class="img-responsive img-content" src=refeeding_1.png></a><p class=caption>What doesn't kill you makes you stronger (or at least as strong as before). First feeding is shifted because I forgot to start the timelapse right away.</p></div><p>Thus, a bit of neglect seems to be okay since the starter appears to be fairly resilient to starvation! (But if you&rsquo;re going on vacation, please feed it more than you typically would so it can sustain itself in your absence.)</p><h2 id=the-conclusion class=anchor><a href=#the-conclusion>The Conclusion</a></h2><p>So what can we take away from ~40 hours of watching yeast rise<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>? From all this, we learned:</p><ul><li>The rate of growth appears to be fairly consistent, even with poorly maintained starters</li><li>A healthy, regularly fed starter reaches maximum fermentation growth after 5-6 hours.</li><li>The peak has a ~1 hour window for when it should be used</li><li>Regularly feeding a neglected starter will make it (and you) happy again</li></ul><p>Even just taking a timelapse will give you a good feel for how your starter behaves, especially when you&rsquo;re starting out with baking bread. If you leave it overnight and come back the next morning to what looks like minimal growth, a timelapse can tell you if it peaked 3 hours in without you noticing, or if it actually didn&rsquo;t grow. Every starter is different, but if you can give it the attention it deserves, its fermentation will continually reward you with loaves like no other.</p><p>Happy baking!</p><hr><h1 id=further-reading class=anchor><a href=#further-reading>Further Reading</a></h1><p>Check out the links below to level-up your bread game. (I may make profit from the Amazon (affiliate) links below, but not the other ones. Those just have good content that I support!)</p><ul><li>Alex French Guy Cooking&rsquo;s Guide to Sourdough <a href="https://www.youtube.com/watch?v=APEavQg8rMw&amp;t=514s">(YouTube)</a></li><li>Trevor J. Wilson&rsquo;s Open Crumb Mastery <a href=http://www.breadwerx.com/open-crumb-mastery/>(Breadwerx</a>, <a href="https://www.youtube.com/watch?v=QHiQ5X3NKEI&amp;t=288s">YouTube)</a></li><li>Tartine Bread <a target=_blank href="https://www.amazon.com/gp/product/0811870413/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0811870413&linkCode=as2&tag=justinmklam-20&linkId=389ae22a493d37c70d3a6c4446a42721">(Amazon)</a><img src="//ir-na.amazon-adsystem.com/e/ir?t=justinmklam-20&l=am2&o=1&a=0811870413" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></li><li>Flour Water Salt Yeast: The Fundamentals of Artisan Bread and Pizza <a target=_blank href="https://www.amazon.com/gp/product/160774273X/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=160774273X&linkCode=as2&tag=justinmklam-20&linkId=9e6460fb3ee23e897b924d08e34709d9">(Amazon)</a><img src="//ir-na.amazon-adsystem.com/e/ir?t=justinmklam-20&l=am2&o=1&a=160774273X" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></li><li>My Bread: The Revolutionary No-Work, No-Knead Method<a target=_blank href="https://www.amazon.com/gp/product/0393066304/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0393066304&linkCode=as2&tag=justinmklam-20&linkId=292f06c9eaad7c87742dbb35cc1d1233"> (Amazon)</a><img src="//ir-na.amazon-adsystem.com/e/ir?t=justinmklam-20&l=am2&o=1&a=0393066304" width=1 height=1 border=0 alt style=border:none!important;margin:0!important></li></ul><blockquote><p>Disclaimer: justinmklam.com is a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for sites to earn advertising fees by advertising and linking to Amazon.com.</p></blockquote><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Which, for the record, is much more interesting than watching paint dry.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=nav-btn><a href=/>&lt; Recent Posts</a></div><hr><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="justinmklam",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><div style=text-align:center><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>Comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>Comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><script defer id=dsq-count-scr src=//justinmklam.disqus.com/count.js async></script></body><footer><div class=footer-container><hr><p>&copy; 2025 Justin Lam | <a href=/colophon>Colophon</a></p></div></footer></html>